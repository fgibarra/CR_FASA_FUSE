[INFO  2022-04-04 11:57:29,904] {main} [cl.ahumada.peya.requester.main.PeyaController-71] - [04/04/22-11:57:29.902] PeyaController - 2.0.0 (08-02-2022) is running
[INFO  2022-04-04 11:57:29,931] {main} [cl.ahumada.peya.requester.main.PeyaController-83] - [ 04/04/22-11:57:29.910 ] PeyaController - 2.0.0 (08-02-2022)  is running a desarrollo
[INFO  2022-04-04 11:57:30,026] {main} [cl.ahumada.peya.requester.servicios.ServiciosdeBus-63] - stock_critico=0 descuentosAplicables=PROMOTION,WEEKLY,JOKER endpoint_ws_mantiene_stock=http://localhost:8080/ESB/mantieneStock/tienda/buscar endpoint_ws_informeDeshabilita=http://localhost:8080/ESB/informeDeshabilitado/skusOrder stockEndPoint=http://localhost:8181/cxf/ESB/Stock/tienda/buscar stockEndPoint2=http://localhost:8080/ESB/Stock/tienda/buscar pedidosEndPoint=http://localhost:8181/cxf/ESB/pedidosV4mock/detalle/generar
[INFO  2022-04-04 11:57:30,072] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-58] - endpoint_ws_mantiene_stock=http://localhost:8080/ESB/mantieneStock/tienda/buscar endpoint_ws_informeDeshabilita=http://localhost:8080/ESB/informeDeshabilitado/skusOrder stockEndPoint=http://localhost:8181/cxf/ESB/Stock/tienda/buscar pedidosEndPoint=http://localhost:8181/cxf/ESB/pedidosV4mock/detalle/generar
[INFO  2022-04-04 11:57:30,125] {Thread-0} [cl.ahumada.peya.requester.apirest.ReactiveFullDuplexServer-159] - Listening on /[0:0:0:0:0:0:0:0]:8180
[INFO  2022-04-04 11:57:30,458] {main} [cl.ahumada.peya.requester.servicios.ServiciosdeBus-108] - request Stock: {"local":[{"numero_local":1,"stock":[{"codigo_producto":62051008,"cantidad":2},{"codigo_producto":62051009,"cantidad":2},{"codigo_producto":62051010,"cantidad":3}]}]}
[INFO  2022-04-04 11:57:30,460] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-207] - invocaEsbServiceStock: consulta stock a servidor: http://localhost:8181/cxf/ESB/Stock/tienda/buscar
[INFO  2022-04-04 11:57:30,464] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-26] - invokeEndpoint: endpoint=http://localhost:8181/cxf/ESB/Stock/tienda/buscar
json:{"local":[{"numero_local":1,"stock":[{"codigo_producto":62051008,"cantidad":2},{"codigo_producto":62051009,"cantidad":2},{"codigo_producto":62051010,"cantidad":3}]}]}
[DEBUG 2022-04-04 11:57:30,497] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-55] - invokeEndpoint: autorizacion ventas fasa2018 Basic dmVudGFzOmZhc2EyMDE4
[DEBUG 2022-04-04 11:57:30,501] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-65] - invokeEndpoint: antes del POST
[ERROR 2022-04-04 11:57:30,520] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-222] - invocaEsbServiceStock
java.lang.RuntimeException: Failed to invoke Endpoint: 'http://localhost:8181/cxf/ESB/Stock/tienda/buscar'.
	at cl.ahumada.peya.requester.servicios.RestApiClient.invokeEndpoint(RestApiClient.java:82)
	at cl.ahumada.peya.requester.servicios.InvocaESB.invocaEsbServiceStock(InvocaESB.java:211)
	at cl.ahumada.peya.requester.servicios.InvocaESB.invocaEsbServiceStock(InvocaESB.java:196)
	at cl.ahumada.peya.requester.servicios.InvocaESB.hayStock(InvocaESB.java:75)
	at cl.ahumada.peya.requester.servicios.InvocaESB.hayStock(InvocaESB.java:67)
	at cl.ahumada.peya.requester.servicios.ServiciosdeBus.confirmaStock(ServiciosdeBus.java:115)
	at cl.ahumada.peya.requester.peyasdk.threads.ProcesaOrden.procesa(ProcesaOrden.java:67)
	at cl.ahumada.peya.requester.main.PeyaController.main(PeyaController.java:103)
Caused by: java.net.ConnectException: Connection refused
	at java.base/sun.nio.ch.Net.connect0(Native Method)
	at java.base/sun.nio.ch.Net.connect(Net.java:574)
	at java.base/sun.nio.ch.Net.connect(Net.java:563)
	at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:588)
	at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:333)
	at java.base/java.net.Socket.connect(Socket.java:648)
	at java.base/java.net.Socket.connect(Socket.java:597)
	at java.base/java.net.Socket.<init>(Socket.java:520)
	at java.base/java.net.Socket.<init>(Socket.java:370)
	at org.apache.commons.httpclient.protocol.DefaultProtocolSocketFactory.createSocket(DefaultProtocolSocketFactory.java:80)
	at org.apache.commons.httpclient.protocol.DefaultProtocolSocketFactory.createSocket(DefaultProtocolSocketFactory.java:122)
	at org.apache.commons.httpclient.HttpConnection.open(HttpConnection.java:707)
	at org.apache.commons.httpclient.HttpMethodDirector.executeWithRetry(HttpMethodDirector.java:387)
	at org.apache.commons.httpclient.HttpMethodDirector.executeMethod(HttpMethodDirector.java:171)
	at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:397)
	at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:323)
	at cl.ahumada.peya.requester.servicios.RestApiClient.invokeEndpoint(RestApiClient.java:66)
	... 7 more
[INFO  2022-04-04 11:57:30,525] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-207] - invocaEsbServiceStock: consulta stock a servidor: http://localhost:8080/ESB/Stock/tienda/buscar
[INFO  2022-04-04 11:57:30,530] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-26] - invokeEndpoint: endpoint=http://localhost:8080/ESB/Stock/tienda/buscar
json:{"local":[{"numero_local":1,"stock":[{"codigo_producto":62051008,"cantidad":2},{"codigo_producto":62051009,"cantidad":2},{"codigo_producto":62051010,"cantidad":3}]}]}
[DEBUG 2022-04-04 11:57:30,531] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-55] - invokeEndpoint: autorizacion ventas fasa2018 Basic dmVudGFzOmZhc2EyMDE4
[DEBUG 2022-04-04 11:57:30,531] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-65] - invokeEndpoint: antes del POST
[ERROR 2022-04-04 11:57:30,535] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-222] - invocaEsbServiceStock
java.lang.RuntimeException: Failed to invoke Endpoint: 'http://localhost:8080/ESB/Stock/tienda/buscar'.
	at cl.ahumada.peya.requester.servicios.RestApiClient.invokeEndpoint(RestApiClient.java:82)
	at cl.ahumada.peya.requester.servicios.InvocaESB.invocaEsbServiceStock(InvocaESB.java:211)
	at cl.ahumada.peya.requester.servicios.InvocaESB.invocaEsbServiceStock(InvocaESB.java:199)
	at cl.ahumada.peya.requester.servicios.InvocaESB.hayStock(InvocaESB.java:75)
	at cl.ahumada.peya.requester.servicios.InvocaESB.hayStock(InvocaESB.java:67)
	at cl.ahumada.peya.requester.servicios.ServiciosdeBus.confirmaStock(ServiciosdeBus.java:115)
	at cl.ahumada.peya.requester.peyasdk.threads.ProcesaOrden.procesa(ProcesaOrden.java:67)
	at cl.ahumada.peya.requester.main.PeyaController.main(PeyaController.java:103)
Caused by: java.net.ConnectException: Connection refused
	at java.base/sun.nio.ch.Net.connect0(Native Method)
	at java.base/sun.nio.ch.Net.connect(Net.java:574)
	at java.base/sun.nio.ch.Net.connect(Net.java:563)
	at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:588)
	at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:333)
	at java.base/java.net.Socket.connect(Socket.java:648)
	at java.base/java.net.Socket.connect(Socket.java:597)
	at java.base/java.net.Socket.<init>(Socket.java:520)
	at java.base/java.net.Socket.<init>(Socket.java:370)
	at org.apache.commons.httpclient.protocol.DefaultProtocolSocketFactory.createSocket(DefaultProtocolSocketFactory.java:80)
	at org.apache.commons.httpclient.protocol.DefaultProtocolSocketFactory.createSocket(DefaultProtocolSocketFactory.java:122)
	at org.apache.commons.httpclient.HttpConnection.open(HttpConnection.java:707)
	at org.apache.commons.httpclient.HttpMethodDirector.executeWithRetry(HttpMethodDirector.java:387)
	at org.apache.commons.httpclient.HttpMethodDirector.executeMethod(HttpMethodDirector.java:171)
	at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:397)
	at org.apache.commons.httpclient.HttpClient.executeMethod(HttpClient.java:323)
	at cl.ahumada.peya.requester.servicios.RestApiClient.invokeEndpoint(RestApiClient.java:66)
	... 7 more
[DEBUG 2022-04-04 11:57:30,540] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-76] - hayStock: stockResponse: vienen datos:local
numeroLocal=1
stock[0]=codigoProducto=1
cantidad=1

indiceCumplimiento=0

[INFO  2022-04-04 11:57:30,541] {main} [cl.ahumada.peya.requester.peyasdk.threads.ProcesaOrden-72] - se RECHAZA orden: 1
[INFO  2022-04-04 12:00:04,609] {main} [cl.ahumada.peya.requester.main.PeyaController-71] - [04/04/22-12:00:04.609] PeyaController - 2.0.0 (08-02-2022) is running
[INFO  2022-04-04 12:00:04,619] {main} [cl.ahumada.peya.requester.main.PeyaController-83] - [ 04/04/22-12:00:04.614 ] PeyaController - 2.0.0 (08-02-2022)  is running a desarrollo
[INFO  2022-04-04 12:00:04,698] {main} [cl.ahumada.peya.requester.servicios.ServiciosdeBus-63] - stock_critico=0 descuentosAplicables=PROMOTION,WEEKLY,JOKER endpoint_ws_mantiene_stock=http://localhost:8080/ESB/mantieneStock/tienda/buscar endpoint_ws_informeDeshabilita=http://localhost:8080/ESB/informeDeshabilitado/skusOrder stockEndPoint=http://localhost:8181/cxf/ESB/Stock/tienda/buscar stockEndPoint2=http://localhost:8080/ESB/Stock/tienda/buscar pedidosEndPoint=http://localhost:8181/cxf/ESB/pedidosV4mock/detalle/generar
[INFO  2022-04-04 12:00:04,741] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-58] - endpoint_ws_mantiene_stock=http://localhost:8080/ESB/mantieneStock/tienda/buscar endpoint_ws_informeDeshabilita=http://localhost:8080/ESB/informeDeshabilitado/skusOrder stockEndPoint=http://localhost:8181/cxf/ESB/Stock/tienda/buscar pedidosEndPoint=http://localhost:8181/cxf/ESB/pedidosV4mock/detalle/generar
[INFO  2022-04-04 12:00:04,789] {Thread-0} [cl.ahumada.peya.requester.apirest.ReactiveFullDuplexServer-159] - Listening on /[0:0:0:0:0:0:0:0]:8180
[INFO  2022-04-04 12:01:32,515] {main} [cl.ahumada.peya.requester.servicios.ServiciosdeBus-108] - request Stock: {"local":[{"numero_local":1,"stock":[{"codigo_producto":62051008,"cantidad":2},{"codigo_producto":62051009,"cantidad":2},{"codigo_producto":62051010,"cantidad":3}]}]}
[INFO  2022-04-04 12:02:13,482] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-207] - invocaEsbServiceStock: consulta stock a servidor: http://localhost:8181/cxf/ESB/Stock/tienda/buscar
[INFO  2022-04-04 12:02:13,501] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-26] - invokeEndpoint: endpoint=http://localhost:8181/cxf/ESB/Stock/tienda/buscar
json:{"local":[{"numero_local":1,"stock":[{"codigo_producto":62051008,"cantidad":2},{"codigo_producto":62051009,"cantidad":2},{"codigo_producto":62051010,"cantidad":3}]}]}
[DEBUG 2022-04-04 12:02:13,710] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-55] - invokeEndpoint: autorizacion ventas fasa2018 Basic dmVudGFzOmZhc2EyMDE4
[DEBUG 2022-04-04 12:02:13,724] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-65] - invokeEndpoint: antes del POST
[DEBUG 2022-04-04 12:02:14,883] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-67] - invokeEndpoint: despues del POST; result=200
[DEBUG 2022-04-04 12:02:14,887] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-77] - invokeEndpoint: JSON Respuesta invocacion a http://localhost:8181/cxf/ESB/Stock/tienda/buscar: result:200 statusLine: OK
{"local":[{"numero_local":1,"stock":[{"codigo_producto":62051008,"cantidad":0},{"codigo_producto":62051009,"cantidad":300},{"codigo_producto":62051010,"cantidad":1}]}]}
[DEBUG 2022-04-04 12:02:14,890] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-212] - invocaEsbServiceStock: stockEndPoint responde: ar.status=200
[DEBUG 2022-04-04 12:02:14,891] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-217] - invocaEsbServiceStock: del esb: {"ConsultaStockResponse":{"local":[{"numero_local":1,"stock":[{"codigo_producto":62051008,"cantidad":0},{"codigo_producto":62051009,"cantidad":300},{"codigo_producto":62051010,"cantidad":1}]}]}}
[DEBUG 2022-04-04 12:02:14,895] {main} [cl.ahumada.esb.utils.json.JSonUtilities-47] - response Class =class cl.ahumada.esb.dto.pharol.consultastock.ConsultaStockResponse
[DEBUG 2022-04-04 12:03:00,378] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-76] - hayStock: stockResponse: vienen datos:local
numeroLocal=1
stock[0]=codigoProducto=62051008
cantidad=0

stock[1]=codigoProducto=62051009
cantidad=300

stock[2]=codigoProducto=62051010
cantidad=1

indiceCumplimiento=0

[INFO  2022-04-04 12:06:01,049] {main} [cl.ahumada.peya.requester.peyasdk.threads.ProcesaOrden-68] - se CONFIRMA orden: 1
[INFO  2022-04-04 12:06:27,162] {main} [cl.ahumada.peya.requester.peyasdk.threads.ProcesaOrden-70] - se CONFIRMA se debe reconciliar SI
[DEBUG 2022-04-04 12:06:49,230] {main} [cl.ahumada.peya.requester.servicios.ServiciosdeBus-275] - apiSendOrdenMonitor: json |{"receta":"url to receta","numero-orden":1}|
[DEBUG 2022-04-04 12:06:49,239] {main} [cl.ahumada.peya.requester.servicios.ServiciosdeBus-282] - apiSendOrdenMonitor: request.getURI()=http://localhost:8181/cxf/ESB/monitorLogistico/procesar
[DEBUG 2022-04-04 12:06:49,288] {main} [cl.ahumada.peya.requester.servicios.Semaforo-74] - opP: espera Thread [main]. valor=-1
[INFO  2022-04-04 12:06:50,428] {server-dispatch-1} [cl.ahumada.peya.requester.apirest.ReactiveFullDuplexServer-68] - onRequestHead: getRemoteAddress: /127.0.0.1:45954 RequestLine(request):GET /peyaRequester?numeroOrden=1&confirma=1 HTTP/1.1 request.getRequestUri(): /peyaRequester?numeroOrden=1&confirma=1
[INFO  2022-04-04 12:06:50,429] {server-dispatch-1} [cl.ahumada.peya.requester.apirest.ReactiveFullDuplexServer-167] - setParametrosURI: requestUri /peyaRequester?numeroOrden=1&confirma=1
[INFO  2022-04-04 12:06:50,429] {server-dispatch-1} [cl.ahumada.peya.requester.apirest.ReactiveFullDuplexServer-170] - setParametrosURI: data numeroOrden=1&confirma=1
[INFO  2022-04-04 12:06:50,430] {server-dispatch-1} [cl.ahumada.peya.requester.apirest.ReactiveFullDuplexServer-175] - setParametrosURI: numeroOrden 1, resultado=1
[INFO  2022-04-04 12:06:50,439] {server-dispatch-1} [cl.ahumada.peya.requester.apirest.ReactiveFullDuplexServer-102] - reconoce path /peyaRequester
[INFO  2022-04-04 12:06:50,439] {server-dispatch-1} [cl.ahumada.peya.requester.apirest.ReactiveFullDuplexServer-190] - callbackPeya: numeroOrden 1, resultado=1
[DEBUG 2022-04-04 12:06:50,440] {server-dispatch-1} [cl.ahumada.peya.requester.servicios.Semaforo-104] - opV: encontro esperando a main valor=0
[DEBUG 2022-04-04 12:06:50,440] {server-dispatch-1} [cl.ahumada.peya.requester.servicios.Semaforo-111] - opV: Thread [server-dispatch-1]. valor=0
[DEBUG 2022-04-04 12:06:50,440] {main} [cl.ahumada.peya.requester.servicios.Semaforo-86] - opP: continua Thread [main]. valor=0
[INFO  2022-04-04 12:06:50,471] {server-dispatch-1} [cl.ahumada.peya.requester.apirest.ReactiveFullDuplexServer-78] - onResponseHead: getRemoteAddress: /127.0.0.1:45954 StatusLine(request):HTTP/1.1 200 OK
[INFO  2022-04-04 12:06:50,474] {server-dispatch-1} [cl.ahumada.peya.requester.apirest.ReactiveFullDuplexServer-87] - onExchangeComplete: getRemoteAddress: /127.0.0.1:45954  exchange completed (connection kept alive)
[INFO  2022-04-04 12:07:30,707] {main} [cl.ahumada.peya.requester.servicios.ServiciosdeBus-63] - stock_critico=0 descuentosAplicables=PROMOTION,WEEKLY,JOKER endpoint_ws_mantiene_stock=http://localhost:8080/ESB/mantieneStock/tienda/buscar endpoint_ws_informeDeshabilita=http://localhost:8080/ESB/informeDeshabilitado/skusOrder stockEndPoint=http://localhost:8181/cxf/ESB/Stock/tienda/buscar stockEndPoint2=http://localhost:8080/ESB/Stock/tienda/buscar pedidosEndPoint=http://localhost:8181/cxf/ESB/pedidosV4mock/detalle/generar
[INFO  2022-04-04 12:07:30,712] {main} [cl.ahumada.peya.requester.servicios.InvocaESB-58] - endpoint_ws_mantiene_stock=http://localhost:8080/ESB/mantieneStock/tienda/buscar endpoint_ws_informeDeshabilita=http://localhost:8080/ESB/informeDeshabilitado/skusOrder stockEndPoint=http://localhost:8181/cxf/ESB/Stock/tienda/buscar pedidosEndPoint=http://localhost:8181/cxf/ESB/pedidosV4mock/detalle/generar
[DEBUG 2022-04-04 12:07:30,714] {main} [cl.ahumada.peya.requester.servicios.ServiciosdeBus-209] - findProducto: integrationCode: 62051010 codigo: 62051008
[DEBUG 2022-04-04 12:07:30,716] {main} [cl.ahumada.peya.requester.servicios.ServiciosdeBus-209] - findProducto: integrationCode: 62051010 codigo: 62051009
[DEBUG 2022-04-04 12:07:30,717] {main} [cl.ahumada.peya.requester.servicios.ServiciosdeBus-209] - findProducto: integrationCode: 62051010 codigo: 62051010
